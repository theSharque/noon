<?php

/**
 * Implements hook_permission().
 */
function auction_permission() {
  return array(

    'auction user' => array(
      'title' => t('User of auction system'),
    ),

    'auction admin' => array(
      'title' => t('Administrator of auction system'),
    ),
  );
}

/**
 * Implements hook_menu().
 */
function auction_menu() {

// Banner managers menu

  $items['auction'] = array(
    'title' => 'Auction admin',
    'description' => 'Show current auction.',
    'page callback' => 'drupal_get_form',
    'page arguments' => array( 'auction_admin_page' ),
    'access arguments' => array('auction admin'),
    'file' => 'auction.inc',
  );

  $items['auction/list'] = array(
    'title' => 'Auction admin',
    'description' => 'Show current auction.',
    'page callback' => 'drupal_get_form',
    'page arguments' => array( 'auction_admin_page' ),
    'access arguments' => array('auction admin'),
    'type' => MENU_DEFAULT_LOCAL_TASK,
    'weight' => 0,
    'file' => 'auction.inc',
  );

  $items['auction/add'] = array(
    'title' => 'Add auction',
    'description' => 'Add new auction.',
    'page callback' => 'drupal_get_form',
    'page arguments' => array( 'auction_edit' ),
    'access arguments' => array('auction admin'),
    'type' => MENU_LOCAL_TASK,
    'weight' => 20,
    'file' => 'auction.inc',
  );

  $items['auction/%/edit'] = array(
    'title' => 'Edit auction',
    'description' => 'Edit selected auction.',
    'page callback' => 'drupal_get_form',
    'page arguments' => array( 'auction_edit', 1 ),
    'access arguments' => array('auction admin'),
    'weight' => 30,
    'file' => 'auction.inc',
  );

  $items['lot'] = array(
    'title' => 'Auction',
    'description' => 'Show current auction.',
    'page callback' => 'drupal_get_form',
    'page arguments' => array( 'auction_page' ),
    'access arguments' => array('auction user'),
    'file' => 'auction.inc',
  );

  $items['lot/view'] = array(
    'title' => 'Auction',
    'description' => 'Show current auction.',
    'page callback' => 'drupal_get_form',
    'page arguments' => array( 'auction_page' ),
    'access arguments' => array('auction user'),
    'type' => MENU_DEFAULT_LOCAL_TASK,
    'weight' => 0,
    'file' => 'auction.inc',
  );

  $items['pay'] = array(
    'title' => 'Pay',
    'description' => 'Pay to your account.',
    'page callback' => 'drupal_get_form',
    'page arguments' => array( 'auction_pay' ),
    'access arguments' => array('auction user'),
    'file' => 'auction.inc',
  );

  $items['pay/view'] = array(
    'title' => 'Pay',
    'description' => 'Pay to your account.',
    'page callback' => 'drupal_get_form',
    'page arguments' => array( 'auction_pay' ),
    'access arguments' => array('auction user'),
    'type' => MENU_DEFAULT_LOCAL_TASK,
    'weight' => 0,
    'file' => 'auction.inc',
  );

  $items['bidder'] = array(
    'page callback' => 'auction_bidder',
    'access arguments' => array('auction user'),
    'file' => 'auction.inc',
  );

  return $items;
}

function auction_user_view( $account, $view_mode, $langcode ) {

  global $user;

  $query = db_select( 'users_money', 'um' );
  $query->fields( 'um', array( 'money', 'published' ) );
  $query->condition( 'um.uid', $user->uid, '=' );
  $money = $query->execute()->fetchAssoc();

  $account->content['money'] = array(
    '#type' => 'user_profile_item',
    '#title' => t('Your money'),
    '#markup' => $money['money'],
  );
}
